<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>secret_request</title>
    <link rel="stylesheet" href="CSS/stylle.css">
</head>
<body>
    <div>
        <h1>QUER NAMORAR COMIGO?</h1>
    </div>
    <div>
        <form action="secret_request" method="post">
            <button type="submit">SIM</button>
        </form>
        <form action="secret_request" method="post">
            <button type="submit">N√ÉO</button>
        </form>
    </div>
    <script>
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const buttonText = this.querySelector('button').innerText;
                fetch('/secret_request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ response: buttonText })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                });
            });
        });
    //a√ß√£o que faz o bot√£o "N√£o" ficar se movendo aleatoriamente pela tela quando o mouse se aproxima de forma que de para clica nele depois de algumas tentativas definidas aleatoriamente por um range aleat√≥rio e depois de clicar a contagem de tentativas √© zerada
    const noButton = document.querySelectorAll('form')[1].querySelector('button');
    let attempts = 0;
    const maxAttempts = Math.floor(Math.random() * 18) + 8; // n√∫mero aleat√≥rio entre 8 e 25
    noButton.addEventListener('mouseover', function() {
        if (attempts < maxAttempts) {
            attempts++;
            const x = Math.random() * (window.innerWidth - noButton.offsetWidth);
            const y = Math.random() * (window.innerHeight - noButton.offsetHeight);
            noButton.style.position = 'absolute';
            noButton.style.left = `${x}px`;
            noButton.style.top = `${y}px`;
        } else {
            attempts = 0;
        }
    });
    //bot√£o "sim" que quando clicado abre um pop-up com a localiza√ß√£o do restaurante
    document.querySelectorAll('form')[0].addEventListener('submit', function(event)
    {
        event.preventDefault();
        alert('Vamos ao restaurante X, que fica na Rua Y, n√∫mero Z. Te espero l√°! ‚ù§Ô∏è');
    });
    //bot√£o "n√£o" que quando clicado abre um pop-up com uma mensagem engra√ßada que muda a cada clique nessa ordem
    const noMessages = [
        'Acho que voc√™ n√£o tem essa op√ß√£o! üòú',
        'N√£o adianta tentar fugir! üòé',
        'Porque insistir no erro? üòè',
        'Estranho voce insistir tanto assim ü§î',
        'Okay, agora voce realmente n√£o tem essa op√ß√£o mais! üòÅ'
    ];
    let noMessageIndex = 0;
    document.querySelectorAll('form')[1].addEventListener('submit', function(event)
    {
        event.preventDefault();
        alert(noMessages[noMessageIndex]);
        noMessageIndex = (noMessageIndex + 1) % noMessages.length;
    });
    //apos clicar no bot√£o n√£o 5 vezez, ele some da tela
    let noClickCount = 0;
    document.querySelectorAll('form')[1].addEventListener('submit', function(event)
    {
        event.preventDefault();
        noClickCount++;
        if (noClickCount >= 5) {
            noButton.style.display = 'none';
        }
    });
    //enviar notifica√ß√£o para o email eberteclas@gmail.com toda vez que um dos bot√µes for clicado
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const buttonText = this.querySelector('button').innerText;
            fetch('/send_email', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ response: buttonText })
            });
        });
    });
    //get user ip na vari√°vel user_ip
    let user_ip = '';
    fetch('https://api.ipify.org?format=json')
    .then(response => response.json())
    .then(data => {
        user_ip = data.ip;
    });
    //armazenar quantas vezes cada bot√£o foi clicado e o ip do usu√°rio e ao clcar no n√£o 5 vezes ou sim 1 vez ao clicar no sim enviar uma notifica√ß√£o via formspree chave https://formspree.io/f/mvgbvnpv com a quantidade de cliques em cada bot√£o e o IP do usu√°rio
    let simClickCount = 0;
    let naoClickCount = 0;
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const buttonText = this.querySelector('button').innerText;
            if (buttonText === 'SIM') {
                simClickCount++;
            } else {
                naoClickCount++;
            }
            if (simClickCount >= 1 || naoClickCount >= 5) {
                fetch('https://formspree.io/f/mvgbvnpv', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        simClicks: simClickCount, 
                        naoClicks: naoClickCount,
                        ip:  user_ip
                    })
                });
            }
        });
    });
    </script>
</body>
</html>