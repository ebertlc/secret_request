<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>secret_request</title>
    <link rel="stylesheet" href="CSS/stylle.css">
</head>
<body>
    <div>
        <h1>QUER NAMORAR COMIGO?</h1>
    </div>
    <div>
        <form action="secret_request" method="post">
            <button type="submit">SIM</button>
        </form>
        <form action="secret_request" method="post">
            <button type="submit">N√ÉO</button>
        </form>
    </div>
    <script>
        const formularioSim = document.querySelectorAll('form')[0];
        const formularioNao = document.querySelectorAll('form')[1];
        const botaoNao = formularioNao.querySelector('button');

        const MAX_TENTATIVAS_MOUSE = Math.floor(Math.random() * 18) + 8; // Entre 8 e 25
        const MAX_CLIQUES_NAO = 5;
        const URL_FORMSPREE = 'https://formspree.io/f/mvgbvnpv';
        const MENSAGENS_BOTAO_NAO = [
            'Acho que voc√™ n√£o tem essa op√ß√£o! üòú',
            'N√£o adianta tentar fugir! üòé',
            'Por que insistir no erro? üòè',
            'Estranho voc√™ insistir tanto assim ü§î',
            'Okay, agora voc√™ realmente n√£o tem mais essa op√ß√£o! üòÅ'
        ];

        let tentativasMouse = 0;
        let cliquesBotaoSim = 0;
        let cliquesBotaoNao = 0;
        let indiceMensagemNao = 0;
        let ipPublico = '';
        let ipLocal = '';

        function moverBotaoNaoAleatoriamente() {
            if (tentativasMouse < MAX_TENTATIVAS_MOUSE) {
                tentativasMouse++;

                const x = Math.random() * (window.innerWidth - botaoNao.offsetWidth);
                const y = Math.random() * (window.innerHeight - botaoNao.offsetHeight);

                botaoNao.style.position = 'absolute';
                botaoNao.style.left = `${x}px`;
                botaoNao.style.top = `${y}px`;
            } else {
                tentativasMouse = 0;
            }
        }

        function enviarAnalise(resposta) {
            const dados = {
                respostaFinal: resposta,
                quantidadeCliquesSim: cliquesBotaoSim,
                quantidadeCliquesNao: cliquesBotaoNao,
                ipPublico: ipPublico,
                ipLocal: ipLocal
            };

            fetch(URL_FORMSPREE, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dados)
            }).then(response => {
                if (response.ok) {
                    console.log('Dados de an√°lise enviados com sucesso!');
                } else {
                    console.error('Falha ao enviar dados de an√°lise.');
                }
            }).catch(error => {
                console.error('Erro na requisi√ß√£o para o Formspree:', error);
            });
        }

        function obterIPs() {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    ipPublico = data.ip;
                })
                .catch(error => console.error('Erro ao obter IP p√∫blico:', error));

            fetch('https://geolocation-db.com/json/')
                .then(response => response.json())
                .then(data => {
                    ipLocal = data.IPv4;
                })
                .catch(error => console.error('Erro ao obter IP local:', error));
        }

        botaoNao.addEventListener('mouseover', moverBotaoNaoAleatoriamente);

        formularioSim.addEventListener('submit', function(evento) {
            evento.preventDefault();
            cliquesBotaoSim++;

            alert('Vamos ao restaurante X, que fica na Rua Y, n√∫mero Z. Te espero l√°! ‚ù§Ô∏è');

            enviarAnalise('SIM');
        });


        formularioNao.addEventListener('submit', function(evento) {
            evento.preventDefault();
            cliquesBotaoNao++;

            alert(MENSAGENS_BOTAO_NAO[indiceMensagemNao]);

            indiceMensagemNao = (indiceMensagemNao + 1) % MENSAGENS_BOTAO_NAO.length;

            if (cliquesBotaoNao >= MAX_CLIQUES_NAO) {
                botaoNao.style.display = 'none';
                enviarAnalise('N√ÉO (ap√≥s 5 tentativas)');
            }
        });

        obterIPs();
    </script>
</body>
</html>